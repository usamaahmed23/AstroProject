---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import FormattedDate from '../../components/FormattedDate.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const tags = new Set(allPosts.flatMap(post => post.data.tags));
  
  return Array.from(tags).map(tag => {
    const posts = allPosts
      .filter(post => post.data.tags.includes(tag))
      .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
    
    return {
      params: { tag },
      props: { tag, posts },
    };
  });
}

const { tag, posts } = Astro.props;
---

<Layout title={`Posts tagged with #${tag}`}>
  <h1 class="text-3xl font-bold mb-8">Posts tagged with <span class="text-blue-600 dark:text-blue-400">#{tag}</span></h1>
  
  <div class="space-y-8">
    {posts.map(post => (
      <article class="border-b border-gray-200 dark:border-gray-700 pb-8">
        <h2 class="text-2xl font-bold mb-2">
          <a 
            href={`/blog/${post.slug}`} 
            class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
          >
            {post.data.title}
          </a>
        </h2>
        <div class="flex items-center space-x-2 text-sm mb-2">
          <FormattedDate date={post.data.pubDate} />
        </div>
        <p class="text-gray-600 dark:text-gray-300">{post.data.description}</p>
      </article>
    ))}
  </div>
</Layout>
